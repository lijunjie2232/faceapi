# Multi-stage build for frontend
FROM node:24-alpine as builder

# Create app directory
WORKDIR /app

# Copy package files
COPY frontend/package*.json ./

# Install dependencies
RUN npm install -g pnpm && pnpm install

# Copy source code
COPY frontend/ ./

# Download face detection models
COPY frontend/scripts/download_models.js ./download_models.js

RUN node download_models.js

# Expose port (matching vite.config.js server port)
EXPOSE 3000

# Start development server using npm script
CMD ["sh", "-c", "pnpm run serve --host 0.0.0.0 --port 3000"]